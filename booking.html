<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Booking ‚Äî Jayvee Hall of Mansion</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <main class="container">
    <header class="header">
      <a class="brand" href="home.html"><img src="logo.jpg" alt="logo"><div><h1>JAYVEE HALL OF MANSION</h1></div></a>
      <div class="nav">
        <a href="home.html">HOME</a>
        <a href="room.html">ROOM</a>
        <a href="cart.html">CART</a>
        <a href="message.html">MESSAGE</a>
        <a href="notification.html">NOTIFICATION</a>
        <a href="adminpanel.html">ADMIN</a>
        <button class="icon-btn" id="menuBtn">‚ò∞</button>
      </div>
    </header>

    <section class="card">
      <h3>RESERVATION FORM</h3>
      <p class="small">Complete the form to reserve your selected room. Check-in within 12‚Äì24 hours only.</p>

      <div style="display:flex;gap:16px;flex-direction:column;">
        <div style="display:flex;gap:12px;align-items:center">
          <div style="width:120px;height:80px;overflow:hidden;border-radius:8px"><img id="roomImg" src="image1.jpg" style="width:100%;height:100%;object-fit:cover"></div>
          <div style="flex:1">
            <div id="roomName" style="font-weight:800">Room Name</div>
            <div class="kv" id="roomNumber">Room #</div>
            <div class="kv" id="roomPrice">Price</div>
          </div>
        </div>

        <form id="bookingForm">
          <div class="form-row">
            <label class="kv">Full Name (required)</label>
            <input class="input" id="fullname" required>
          </div>

          <div class="form-row">
            <label class="kv">Face Scan or Upload (required)</label>
            <input type="file" id="face" accept="image/*" required>
            <div id="facePreview" style="margin-top:8px"></div>
          </div>

          <div class="form-row">
            <label class="kv">Date Check In (required, 12-24 hrs)</label>
            <input class="input" type="datetime-local" id="checkin" required>
          </div>

          <div class="form-row">
            <label class="kv">Payment Method (required)</label>
            <select id="paymethod" class="input" required>
              <option value="">Select</option>
              <option value="Cash">Cash</option>
              <option value="GCash">Online - GCash</option>
            </select>
            <div class="small" style="margin-top:6px">If paying online, pay to GCash: 09464766208. Exact price only.</div>
          </div>

          <div class="form-row">
            <label class="kv">Proof of Payment (required if GCash)</label>
            <input type="file" id="proof" accept="image/*">
            <div id="proofPreview" style="margin-top:8px"></div>
          </div>

          <div style="display:flex;gap:8px">
            <button type="button" id="reviewBtn" class="btn btn-outline">Review</button>
            <button type="submit" class="btn btn-primary">Confirm</button>
            <button type="button" id="cancelBtn" class="btn btn-outline">Cancel</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <aside class="side-menu" id="sideMenu">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Connect</strong>
      <button class="icon-btn" id="closeMenu">‚úï</button>
    </div>
    <div class="socials">
      <a href="https://www.facebook.com/JaysGumcar" target="_blank">üîµ Facebook</a>
      <a href="https://www.instagram.com/JaysGumcar" target="_blank">üì∏ Instagram</a>
      <a href="https://www.thread.com/JaysGumcar" target="_blank">üßµ Thread</a>
      <a href="mailto:jayveecaringal07@gmail.com" target="_blank">‚úâÔ∏è Email</a>
      <a href="https://www.telegram.com/JaysGumcar" target="_blank">üì® Telegram</a>
      <a href="About.html">‚ÑπÔ∏è About</a>
    </div>
  </aside>

  <footer class="footer">
    <div class="container">
      <div class="small-muted">Avoid booking duplicates: one booking per room per check-in time.</div>
      <div class="kv">Reservation</div>
    </div>
  </footer>

  <script>
    document.getElementById('menuBtn').addEventListener('click', ()=> document.getElementById('sideMenu').classList.add('open'));
    document.getElementById('closeMenu').addEventListener('click', ()=> document.getElementById('sideMenu').classList.remove('open'));

    // pre-fill from selectedRoom
    const selected = JSON.parse(localStorage.getItem('selectedRoom')||'{}') || {};
    if(selected && selected.name){
      document.getElementById('roomImg').src = selected.img || 'image1.jpg';
      document.getElementById('roomName').textContent = selected.name;
      document.getElementById('roomNumber').textContent = 'Room #' + selected.id;
      document.getElementById('roomPrice').textContent = 'Price: ‚Ç± ' + Number(selected.price).toLocaleString();
    }

    // previews
    document.getElementById('face').addEventListener('change', function(){
      const f = this.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      document.getElementById('facePreview').innerHTML = `<img src="${url}" style="height:80px;border-radius:8px;object-fit:cover">`;
    });
    document.getElementById('proof').addEventListener('change', function(){
      const f = this.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      document.getElementById('proofPreview').innerHTML = `<img src="${url}" style="height:80px;border-radius:8px;object-fit:cover">`;
    });

    document.getElementById('cancelBtn').addEventListener('click', ()=>{
      if(confirm('Cancel reservation?')) window.history.back();
    });

    document.getElementById('reviewBtn').addEventListener('click', ()=>{
      const name = document.getElementById('fullname').value.trim();
      const checkin = document.getElementById('checkin').value;
      if(!name||!checkin){ alert('Please fill required fields for review'); return;}
      const room = selected;
      const price = room.price || 0;
      alert(`Review:\nName: ${name}\nRoom: ${room.name}\nPrice: ‚Ç± ${Number(price).toLocaleString()}\nCheck-in: ${new Date(checkin).toLocaleString()}`);
    });

    document.getElementById('bookingForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const name = document.getElementById('fullname').value.trim();
      const faceFile = document.getElementById('face').files[0];
      const checkin = document.getElementById('checkin').value;
      const paymethod = document.getElementById('paymethod').value;
      const proofFile = document.getElementById('proof').files[0];

      if(!name||!faceFile||!checkin||!paymethod){ alert('Please fill required fields'); return; }

      if(paymethod === 'GCash' && !proofFile){ alert('Proof of payment required for online payment'); return; }

      // store files as data URLs (small)
      const toDataURL = (file) => new Promise(res=>{
        const reader = new FileReader();
        reader.onload = ()=>res(reader.result);
        reader.readAsDataURL(file);
      });

      const faceData = await toDataURL(faceFile);
      const proofData = proofFile ? await toDataURL(proofFile) : null;

      // create booking
      const bookings = JSON.parse(localStorage.getItem('bookings')||'[]');
      const ref = 'JHOM-' + Math.random().toString(36).slice(2,10).toUpperCase();
      const booking = {
        ref,
        name,
        room: selected,
        date: new Date().toLocaleString(),
        checkin,
        paymentMethod: paymethod,
        proof: proofData,
        face: faceData,
        status: 'Pending'
      };
      bookings.push(booking);
      localStorage.setItem('bookings', JSON.stringify(bookings));
      alert('Booking submitted. Reference: ' + ref);
      // add notification will be visible on notification.html and adminpanel
      // navigate to notification
      window.location.href='notification.html';
    });
  </script>
</body>
</html>
